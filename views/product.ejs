<!-- Product Page -->
<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('partials/head') %>
  <title>Product</title>
  <style>
    .product-section {
      max-width: 1000px;
      margin: auto;
      padding: 20px;
    }
    .product-container {
      display: flex;
      flex-direction: row;
      gap: 30px;
      align-items: flex-start;
    }
    .image-container {
      flex: 3;
      position: relative;
    }
    .details-container {
      flex: 2;
      padding: 20px 0;
    }
    .image-slider {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }
    .product-image {
      max-width: 100%;
      max-height: 400px;
      object-fit: contain;
      transition: opacity 0.3s ease-in-out;
    }
    .arrow {
      cursor: pointer;
      font-size: 20px;
      font-weight: bold;
      color: #333;
      background: rgba(255, 255, 255, 0.7);
      padding: 10px;
      border-radius: 50%;
      position: absolute;
      z-index: 10;
    }
    .arrow:hover {
      background: rgba(255, 255, 255, 1);
    }
    .prev {
      left: 5px;
    }
    .next {
      right: 5px;
    }
    .quantity-form {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
    }
    .quantity-input {
      width: 60px;
      text-align: center;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .product-container {
        flex-direction: column;
      }
      .image-container, .details-container {
        flex: 1;
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <section class="product-section">
    <div class="product-container">
      <!-- Image Slider (Left Side, Larger) -->
      <div class="image-container">
        <div class="image-slider">
          <span class="arrow prev" id="prevButton">&#9664;</span>
          <img id="productImage" src="<%= product.imageUrl[0] %>" alt="<%= product.name %>" class="product-image">
          <span class="arrow next" id="nextButton">&#9654;</span>
        </div>
      </div>

      <!-- Product Info (Right Side, Smaller) -->
      <div class="details-container">
        <h2><%= product.name %></h2>
        <p class="text-secondary"><%= product.description %></p>
        <% if (currency === 'NGN') { %>
          <h4>Price: &#8358;<%= parseFloat(product.NGNprice).toFixed(2) %></h4>
        <% } else { %>
          <h4>Price: $<%= parseFloat(product.USDprice).toFixed(2) %></h4>
        <% } %>

        <!-- Update Quantity & Add to Cart -->
        <form action="/cart/update/<%= product._id %>" method="POST" class="quantity-form">
          <input type="number" value="1" name="quantity" min="1" id="quantity_<%= product._id %>"
            class="quantity-input form-control form-control-sm" placeholder="Qty">
          <button type="submit" class="btn btn-dark btn-sm">Add to Cart</button>
        </form>
      </div>
    </div>
  </section>
  <%- include('partials/footer') %>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Parse the JSON string from the server
      let images = <%- JSON.stringify(product.imageUrl) %>;
      let currentIndex = 0;
      const productImage = document.getElementById("productImage");
      
      function updateImage(index) {
        productImage.style.opacity = "0.5"; // Fade effect
        setTimeout(() => {
          productImage.src = images[index];
          productImage.style.opacity = "1";
        }, 200);
      }
      
      function nextImage() {
        currentIndex = (currentIndex + 1) % images.length;
        updateImage(currentIndex);
      }
      
      function prevImage() {
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        updateImage(currentIndex);
      }
      
      // Add event listeners to buttons
      document.getElementById("nextButton").addEventListener('click', nextImage);
      document.getElementById("prevButton").addEventListener('click', prevImage);
    });
  </script>
</body>

</html>