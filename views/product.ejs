<!-- Product Page -->
<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('partials/head') %>
  <title>Product</title>
  <style>
    .product-section {
      max-width: 800px;
      margin: auto;
      padding: 20px;
    }
    .image-slider {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }
    .product-image {
      max-width: 100%;
      max-height: 400px;
      object-fit: contain;
      transition: opacity 0.3s ease-in-out;
    }
    .arrow {
      cursor: pointer;
      font-size: 20px;
      font-weight: bold;
      color: #333;
      background: rgba(255, 255, 255, 0.7);
      padding: 10px;
      border-radius: 50%;
      position: absolute;
    }
    .arrow:hover {
      background: rgba(255, 255, 255, 1);
    }
    .prev {
      left: 5px;
    }
    .next {
      right: 5px;
    }
    .quantity-form {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .quantity-input {
      width: 60px;
      text-align: center;
    }
  </style>
</head>

<body>
  <section class="product-section container">
    <div class="text-center d-flex">
      <!-- Image Slider -->
      <div class="image-slider">
        <span class="arrow prev" id="prevButton">&#9664;</span>
        <img id="productImage" src="<%= product.imageUrl[0] %>" alt="<%= product.name %>" class="product-image">
        <span class="arrow next" id="nextButton">&#9654;</span>
      </div>

      <div class="py-5">
      <!-- Product Info -->
      <h2><%= product.name %></h2>
      <p class="text-secondary"><%= product.description %></p>
      <% if (currency === 'NGN') { %>
        <h4>Price: &#8358;<%= parseFloat(product.NGNprice).toFixed(2) %></h4>
      <% } else { %>
        <h4>Price: $<%= parseFloat(product.USDprice).toFixed(2) %></h4>
      <% } %>

      <!-- Update Quantity & Add to Cart -->
      <form id="qtyForm" action="/cart/update/<%= product._id %>" method="GET" class="ms-5 d-flex justify-content-center align-items-center">
        <input type="number" value="1" name="quantity" min="1" class="form-control form-control-sm" placeholder="Qty">
        <button type="submit" class="btn btn-dark btn-sm">Add to Cart</button>
    </form>    
    </div>
  </section>
  <%- include('partials/footer') %>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Parse the JSON string from the server
      let images = <%- JSON.stringify(product.imageUrl) %>;
      let currentIndex = 0;
      const productImage = document.getElementById("productImage");
      
      function updateImage(index) {
        productImage.style.opacity = "0.5"; // Fade effect
        setTimeout(() => {
          productImage.src = images[index];
          productImage.style.opacity = "1";
        }, 200);
      }
      
      function nextImage() {
        currentIndex = (currentIndex + 1) % images.length;
        updateImage(currentIndex);
      }
      
      function prevImage() {
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        updateImage(currentIndex);
      }
      
      // Add event listeners to buttons
      document.getElementById("nextButton").addEventListener('click', nextImage);
      document.getElementById("prevButton").addEventListener('click', prevImage);
    });

    

</script>
</body>

</html>