<section class="product-showcase-section fade-in">
    <div class="container">
        <div class="services-header fade-in">
            <h2 class="services-title">IN THE SPOTLIGHT</h2>
            <p class="services-subtitle">Discover our most loved and popular handcrafted designs.</p>
        </div>
        <div class="row g-4">
            <% trendingProducts.forEach(product => { %>
                <div class="col-md-4 col-lg-3 col-6">
                    <div class="product-card fade-in">
                        <div class="product-image-wrapper">
                            <a href="/product/<%= product._id %>">
                                <% if (product.imageUrl && product.imageUrl.length > 0) { %>
                                    <img class="product-image"
                                         src="<%= product.imageUrl[0] %>"
                                         alt="<%= product.name %>"
                                         data-images='<%- JSON.stringify(product.imageUrl) %>'>
                                <% } else { %>
                                     <img class="product-image" src="/images/placeholder.jpg" alt="Image coming soon">
                                <% } %>
                            </a>
                            <% if (product.outOfStock) { %>
                                <span class="out-of-stock-badge">Out of stock</span>
                            <% } %>
                        </div>

                        <div class="product-info">
                            <h3 class="product-title" title="<%= product.name %>"><%= product.name %></h3>
                            <p class="product-price">
                                <% if (currency === 'NGN') { %>
                                    &#8358;<%= parseFloat(product.NGNprice).toFixed(2) %>
                                <% } else { %>
                                    $<%= parseFloat(product.USDprice).toFixed(2) %>
                                <% } %>
                            </p>
                        </div>
                        
                        <div class="product-hover-content">
                             <a href="/product/<%= product._id %>" class="view-details-btn">View Details</a>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>
    </div>
</section>

<script src="/scripts/script.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Fade-in animation observer
        const fadeElements = document.querySelectorAll(".fade-in");
        const fadeObserver = new IntersectionObserver(
            (entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add("show");
                        observer.unobserve(entry.target);
                    }
                });
            },
            { threshold: 0.1 }
        );
        fadeElements.forEach(element => fadeObserver.observe(element));

        // Image cycling effect on hover
        document.querySelectorAll('.product-image-wrapper').forEach(wrapper => {
            const image = wrapper.querySelector('.product-image');
            const imageData = image.dataset.images;
            if (!imageData) return;

            const images = JSON.parse(imageData);
            if (images.length > 1) {
                let interval;
                const originalImage = images[0];

                wrapper.addEventListener('mouseenter', () => {
                    let currentIndex = 1;
                    interval = setInterval(() => {
                        image.src = images[currentIndex];
                        currentIndex = (currentIndex + 1) % images.length;
                    }, 1200);
                });

                wrapper.addEventListener('mouseleave', () => {
                    clearInterval(interval);
                    image.src = originalImage; // Reset to the default image
                });
            }
        });
    });
</script>